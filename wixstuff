#!/bin/sh
export CK="$HOME/projects/wix-ck-editor/"
export SV="$HOME/projects/santa/"
export SE="$HOME/projects/santa-editor/"
export WR="$HOME/projects/wix-richtext/"
export CODE_SDK="$HOME/projects/js-wixcode-sdk/"

alias whokilledsanta='open http://santa.wixpress.com'
#teamcity uses same username+password as in your computer
alias openteamcitysantaeditor='open http://tc.dev.wixpress.com/viewType.html?buildTypeId=Santa_SantaEditor'
alias openteamcitysantaviewer='open http://tc.dev.wixpress.com/viewType.html?buildTypeId=HtmlClient_Reactum'
alias openteamcitywixrichtext='open http://tc.dev.wixpress.com/viewType.html?buildTypeId=WixRichtext_WixRichtext&tab=buildTypeStatusDiv'
function startdynamic(){
    (#parentheses causes code to be run in subshell
        trap "kill $(jobs -p)" SIGINT SIGTERM EXIT
        node $SV/beaker/dynamicPages/backend.js &
        cd $SV
        sudo npm start
    )
   wait
}
function startwixrichtextday(){
   {
      cd $WR &&
      git pull &&
      npm i
   }
}
function startsantaday(){
    {
        cd $SV &&
        git pull --rebase &&
        npm  i &&
        grunt all --force &&
        node tern_proj_generator `pwd`/packages > .tern-project
     } | egrep -v $LOG
}
function startsantaeditorday(){
    {
        cd ~/projects/santa-editor &&
        git pull --rebase &&
        npm i &&
        bower install --force &&
        grunt all --force &&
        node tern_proj_generator `pwd`/packages > .tern-project
    } | egrep -v $LOG
}
function startckday(){
    cd ~/projects/wix-ck-editor &&
    git pull --rebase &&
    bower update &&
    grunt all
}
function startwixcodeday(){
    cd ~/projects/js-wixcode-sdk &&
    git pull --rebase &&
    npm i &&
    grunt all &&
    npm run build &&
    cd ~/projects/santa/static/wixcode &&
    grunt &&
    cd ~/projects/santa/static/platform &&
    grunt

}
function startwixday(){
#command inside ( parenthesis ) will be run in a subshell
#allowing for parallelism
    ( startsantaday ) &
    ( startsantaeditorday ) &
    ( startckday ) &
    ( startwixrichtextday ) &
    ( startwixcodeday )
}
function notonmaster(){
    local pwd=$PWD
    cd $SV
    local currbranch="$(git rev-parse --abbrev-ref HEAD)"
    [[ $currbranch != "master" ]] && echo $PWD - $currbranch

    cd $SE
    currbranch="$(git rev-parse --abbrev-ref HEAD)"
    [[ $currbranch != "master" ]] && echo $PWD - $currbranch

    cd $CK
    currbranch="$(git rev-parse --abbrev-ref HEAD)"
    [[ $currbranch != "master" ]] && echo $PWD - $currbranch

    cd $CODE_SDK
    currbranch="$(git rev-parse --abbrev-ref HEAD)"
    [[ $currbranch != "master" ]] && echo $PWD - $currbranch

    cd $pwd
}
function checkoutmasterfunc(){
    cd $1
    echo $fg[yellow]$PWD$reset_color
    git checkout master
    printf '*%.0s' {1..50}
    printf '\n\n'
}
alias checkoutmaster='checkoutmasterfunc ~/projects/wix-ck-editor && checkoutmasterfunc ~/projects/santa && checkoutmasterfunc ~/projects/santa-editor && checkoutmasterfunc ~/projects/js-wixcode-sdk'
